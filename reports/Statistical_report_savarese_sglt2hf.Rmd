---
title: 'Statistical report: Use of the inhibitors of sodium-glucose cotransporter 2 in patients with heart failure'
subtitle: 'DRAFT'
author: 'Statistician: Lina Benson'
  
date: "`r Sys.Date()`"
output:
  pdf_document:
    dev: cairo_pdf
    fig_caption: yes
    fig_height: 7
    fig_width: 7
    number_sections: yes
link-citations: yes
bibliography: references.bib
nocite: '@*'
urlcolor: blue
linkcolor: black
header-includes:
   - \usepackage{draftwatermark}
   - \usepackage{subfig}
   - \usepackage{pdflscape}
   - \newcommand{\blandscape}{\begin{landscape}}
   - \newcommand{\elandscape}{\end{landscape}}
---

\newpage 
\tableofcontents 
\listoftables
\listoffigures
\newpage

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE, include = TRUE, comment = "",
  warning = FALSE, message = FALSE, fig.pos = "H",
  fig.path = "../output/figs/"
)
options(knitr.kable.NA = "")
```

```{r adjust_directory_if_needed, include=FALSE}
# Uncomment lines below if rmd file is placed in a subdirectory
knitr::opts_knit$set(root.dir = normalizePath("../"))
```

```{r load_project}
# 1. Set options in config/global.dcf
# 2. Load packages listed in config/global.dcf
# 3. Import functions and code in lib directory

ProjectTemplate::reload.project()

cacheon <- TRUE
```             

# Data handling

## Data source

SwedeHF combined with national registers, similar to SHFDB4, 
https://kiheartfailure.github.io/shfdb4/, v 4.0.1, but with longer follow-up. 

## Inclusion/exclusion criteria

```{r, child = "./src/flowchart.Rmd"}

```

*if a patient dies immediately after the index visit he/she will not collect a drug prescribed at the index visit
and thereby be defined as a sglt2 user. 

First patient in: `r min(rsdata$shf_indexdtm)` and last patient in: `r max(rsdata$shf_indexdtm)`.  

The median age (IQR) is `r rsdata %>% summarise(med = fn(median(shf_age), dig = 1),
                                             q1 = fn(quantile(shf_age, probs = 0.25), dig = 1),
                                             q3 = fn(quantile(shf_age, probs = 0.75), dig = 1)) %>%
                                   mutate(out = paste0(med, " (", q1, "-", q3, ")")) %>%
                                   pull(out)` and 
`r rsdata %>% count(shf_sex) %>%
  mutate(perc = fn(n / sum(n) * 100, 1)) %>%
  filter(shf_sex == "Female") %>%
  pull(perc)`% females.    

## Created variables 

```{r atc}
default_kable(metalm, caption = "Treatments from Prescribed Drug Register")
```

```{r com}
default_kable(outcommeta, caption = "Comorbidities from NPR")
```

```{r cci}
default_kable(ccimeta, caption = "Charlson Comorbidity Index from NPR")
```

# Statistical analysis 

## General

All analyses were performed using `r sessionInfo()$R.version$version.string` [@r]. 
The level of significance is set to 5%, two-sided. No adjustment for multiple 
comparisons were made and therefore the results should be viewed with some care.

## Missing data

Missing data was imputed with multiple imputation (n = 10) using mice [@mice]. 
Variables included in the model are indicated in 
Table \ref{tab:tab1}. SGLT2i use is not included in the imputation model.  

\clearpage

## SGLT2i over time

The denominator consists of persons that at the 
middle of the month were present in SwedeHF with the specified inclusion/exclusion criteria 
(so included in SwedeHF prior to 20xx-xx-15 but not dead/emigrated as of 20xx-xx-15). 
The numerator consists of the number of patients of the above with at least one SGLT2i 
dispension during that year.  

```{r, child = "./src/overtime.Rmd"}

```

\clearpage

## Baseline characteristics

```{r, child = "./src/tab1.Rmd"}

```

```{r, child = "./src/tab1_rowpercent.Rmd"}

```

\clearpage 

The region is "sjukvÃ¥rdsregion" that the hospital/primary care centre belongs to. 

```{r, child = "./src/regional.Rmd"}

```

\clearpage 

## Associations with SGLT2i use

Odds ratios are estimated using logistic regression with SGLT2i use as outcome. 
Outliers were investigated with Cook's distance and multicollinearity 
with the variance inflation factor.
=> XX. 

```{r, child = "./src/ortab.Rmd"}

```

\clearpage

## Associations with SGLT2i use in subgroups

Odds ratios are estimated using logistic regression with SGLT2i use as outcome. 
The subgroup variable and the other respective variable were included in the model 
using an interaction thereby rendering the interpretation of a subgroup analyses 
but with the advantage of obtaining a p-value. Note therefore that also the adjusted 
estimates are obtained from different models. 

```{r, child = "./src/ortab_int.Rmd"}

```

\clearpage

# Reproducibility

## R session information {#sessioninfo}

```{r sessinfo}
sessionInfo()
```

## R code

The R code for all data handling and statistical analyses are found: 
https://github.com/KIHeartFailure/sglt2ihf. On publication
the repository will be made public so as to 
link to it from the resulting article for increased transparency and code sharing.
No data or output is stored in the repository. 

# References
